<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="title" content="Celebration lottie constructor">
  <title>Celebration lottie constructor</title>

  <link rel="stylesheet" href="./inc/app.css">

<!--  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
<!--  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.6.10/lottie.min.js"></script>-->
  <script type="text/javascript" src="./inc/app.js"></script>

</head>
<body>

<div class="modal is-active is-hidden">
  <div
          class="modal-background has-background-white"
  ></div>
  <div
          class="modal-background has-background-white"
          style="opacity: 0.67;z-index: 2"
  ></div>
  <div>
    <div
            class="image"
            data-animation="background"
            style="
                position:absolute;
                z-index: 1;
                overflow: hidden;
                top: 0; bottom: 0;left: 0;right: 0;
                "
    ></div>
  </div>
  <div class="modal-card is-hidden" style="margin-top: -25vh; z-index: 3">
    <div class="columns is-centered is-vcentered">
      <div class="column" style="margin: 32px; max-width: 400px; max-height: 400px">
        <div data-animation="hero">
        </div>
      </div>
    </div>
    <div class="notification is-black">
      <p id="message-text" class="title has-text-centered">
        Yay! You did it!
      </p>
    </div>
  </div>
</div>
<section id="home-panel">
  <div class="hero is-fullheight">
    <div class="hero-body">
      <div class="container">
        <div class="columns is-centered is-vcentered">
          <div class="column is-narrow">
            <div class="notification is-white">
              <h1 class="title">Hello</h1>
              <h2 class="subtitle">Someone left you a message</h2>
              <div class="has-text-right">
                <a onclick="startShow()" class="button is-primary is-outlined">Watch it</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div style="position: absolute; bottom: 4px; right: 4px">
  <a onclick="a.Reactor.space('config')" class="button is-small is-fullwidth">Make your own custom congratulation</a>
</div>

<section id="config-panel" class="is-hidden">
  <div class="hero is-fullheight is-dark">
    <div class="hero-head">
      <form data-target="sound">
        <div class="columns is-centered is-vcentered notification">
          <div class="column is-1">
            <label class="label">Sound</label>
          </div>

          <div class="column">
            <div class="field has-addons">
              <div class="control is-expanded">
                <input id="sound-mp3" name="mp3" class="input" type="text" value="https://croqo.xyz/storage/app/media/vicetone-tony-igy-astronomia-atari-pokey-cover.mp3">
              </div>
              <div class="control">
                <a class="button" onclick="clipboard.copy($('#sound-mp3'))">paste</a>
              </div>
            </div>
            <p class="help is-dark">mp3 direct link</p>
          </div>
          <div class="column is-narrow">
            <div class="field">
              <div class="control">
                <audio id="sound" controls>
                  <source id="mp3">
                </audio>
              </div>
            </div>
          </div>
        </div>
      </form>

      <div  class="columns is-centered is-vcentered notification">
        <div class="column is-1">
          <label class="label">Foreground</label>
        </div>
        <div class="column">
          <form data-target="message">
            <div class="field">
              <div class="control">
                <textarea name="text" class="textarea" rows="5">Congratulations!</textarea>
              </div>
              <p class="help is-dark">Congratulation text</p>
            </div>
          </form>
        </div>
        <div class="column is-2">
          <form data-target="foreground">
            <div class="field">
              <div class="control">
                <input name="duration" class="input" type="number" step="1000" value="8000">
              </div>
              <p class="help is-dark">Overall duration (ms)</p>
            </div>
            <div class="field">
              <div class="control">
                <input name="delay" class="input" type="number" step="1000" value="0">
              </div>
              <p class="help is-dark">Foreground delay (ms)</p>
            </div>
          </form>
        </div>
      </div>
      <div id="config-animation">
        <div class="columns box">
          <div class="column">
            <form data-target="background">
              <div class="columns is-centered notification">
                <div class="column is-4">
                  <div class="box" data-animation="background">
                    <figure
                            id="background"
                            style="height: 100%; min-width: 100%"
                            class="lottie-player"
                    >
                    </figure>
                  </div>
                </div>
                <div class="column">
                  <p class="title has-text-dark">Background animation</p>
                  <div class="field has-addons">
                    <div class="control is-expanded">
                      <input id="background-animation-path" name="path" class="input" type="text" value="https://assets8.lottiefiles.com/packages/lf20_fSIvGi.json">
                    </div>
                    <div class="control">
                      <a class="button" onclick="pasteFromClipboard($('#background-animation-url'))">paste</a>
                    </div>
                  </div>
                  <p class="level is-mobile help is-dark">
                    <span class="level-left">Background animation json</span>
                    <span class="level-right field">
                                            <span>Loop?</span>
                                            <span class="icon is-small">
                                                <input name="loop" type="checkbox" checked>
                                            </span>
                                        </span>
                  </p>
                  <div class="field">
                    <div class="control is-expanded">
                      <div class="select">
                        <select name="speed">
                          <option value="0.5">x0.5</option>
                          <option selected value="1">Normal</option>
                          <option value="1.5">x1.5</option>
                          <option value="2">x2.0</option>
                          <option value="3">x2.5</option>
                        </select>
                      </div>
                    </div>
                    <p class="help is-dark">Animation speed</p>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="column is-narrow"></div>
          <div class="column">
            <form data-target="hero">
              <div class="columns is-centered notification is-primary">

                <div class="column is-4">
                  <div class="box" data-animation="hero">
                    <figure
                            id="hero"
                            class="lottie-player image"
                    >
                    </figure>
                  </div>
                </div>
                <div class="column">
                  <p class="title">Foreground animation</p>
                  <div class="field has-addons">
                    <div class="control is-expanded">
                      <input id="hero-animation-path" name="path" class="input" type="text" value="https://assets6.lottiefiles.com/private_files/lf30_Y7PQoU.json">
                    </div>
                    <div class="control">
                      <a class="button" onclick="pasteFromClipboard($('#foreground-animation-url'))">paste</a>
                    </div>
                  </div>
                  <p class="level is-mobile help">
                    <span class="level-left">Foreground animation json</span>
                    <span class="level-right field">
                                    Loop?<span class="icon is-small"><input name="loop" type="checkbox" checked></span>
                                </span>
                  </p>

                  <div class="field">

                  </div>
                  <div class="field">
                    <div class="control">
                      <div class="select">
                        <select name="speed">
                          <option value="0.5">x0.5</option>
                          <option selected value="1">Normal</option>
                          <option value="1.5">x1.5</option>
                          <option value="2">x2.0</option>
                          <option value="3">x2.5</option>
                        </select>
                      </div>
                    </div>
                    <p class="help">Animation speed</p>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="hero-body">
      <div class="container">
        <div class="columns is-centered is-vcentered">
          <div class="column is-narrow"></div>
        </div>
      </div>
    </div>
    <div class="hero-foot columns is-centered is-vcentered box">
      <div id="tinyurl" class="column has-text-centered">
        <div id="tinyurl-result" class="field is-grouped is-grouped-centered is-grouped-multiline is-hidden">
          <div class="control">
            <div class="tags has-addons has-addons-centered">
              <span class="tag is-dark"><i></i></span>
              <span class="button tag is-primary" onclick="copyToClipboard($('#tinyurl-result i'))">copy to clipboard</span>
            </div>
          </div>
        </div>
        <div id="tinyurl-button" class="field">
          <div class="control">
            <button onclick="tinyUrl()" class="button is-dark is-outlined is-fullwidth">Get share link</button>
          </div>
        </div>
      </div>
      <div class="column">
        <div class="field">
          <div class="control">
            <button onclick="window.a.Reactor.startShow()" class="button is-primary is-fullwidth">Play!</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!--<script type="text/javascript" src="./inc/app.js"></script>-->

<script>
  // let Url;
  // let Sound;
  // let Config;
  // let Animation;



  // $(document).ready(function () {
  //   Url=a.Route.get();
  //   console.log('cfg: '+ Url);
  //
  //   // if (Url.search!==""){
  //   //   a.Route.set(`#${btoa(Url.search)}`);
  //   // }
  //
  //   init();
  // });
  // $("input, select, textarea").on("change", function () {
  //   updateFormItem(this);
  // });
</script>

<script>
  function init() {
    // Config=a.Core.getConfig();
    // Animation=a.Core.getLotties();
    // Sound=getSound();
    // soundLoad();
  }

  // function tinyUrl() {
  //   let u = Url.origin + Url.pathname + Url.search;
  //   $.get(`https://tinyurl.com/api-create.php?url=${u}`, function(shorturl){
  //     $("#tinyurl-button").addClass("is-hidden");
  //     $("#tinyurl-result i").text(shorturl);
  //     $("#tinyurl-result").removeClass("is-hidden");
  //     console.log(shorturl);
  //   });
  // }
  // function copyToClipboard(element) {
  //   let $temp = $("<input>");
  //   $("body").append($temp);
  //   $temp.val($(element).text()).select();
  //   document.execCommand("copy");
  //   $temp.remove();
  // }
  // function pasteFromClipboard(element) {
  //   navigator.clipboard.readText().then(
  //           clipText => {
  //             $(element).val(clipText);
  //             updateFormItem(element);
  //           });
  // }

  // function getLotties() {
  //   let result = [];
  //   $('.lottie-player').each(function(index){
  //     let player = $('.lottie-player').get(index);
  //     let id = player.getAttribute('id');
  //     result[id] = getLottie(id);
  //   });
  //   return result;
  // }
  //
  // function getLottie(id) {
  //   let config = Config[id];
  //   let container = document.getElementById(id);
  //   let result = lottie.loadAnimation({
  //     container: container,
  //     renderer: 'svg',
  //     loop: !!config.loop,
  //     autoplay: true,
  //     path: config.url,
  //     rendererSettings: {
  //       progressiveLoad: true,
  //       preserveAspectRatio: 'xMidYMid slice'
  //     }
  //   });
  //   result.setSpeed(config.speed);
  //   return result;
  // }
  // function resetLottie(id) {
  //   if (!!Animation[id]){
  //     Animation[id].destroy();
  //   }
  //   Animation[id] = getLottie(id);
  // }
  // function attachLotties(selector) {
  //   Object.keys(Animation).forEach(function (item){
  //     attachLottie(item, selector);
  //   });
  // }
  // function attachLottie(id, selector) {
  //   $(`#${id}`).appendTo(`${selector} [data-animation="${id}"]`);
  // }
  // function getConfig() {
  //   let result = [];
  //   setFormsFromUrl(Url.searchParams);
  //   $("form").each(function (index) {
  //     let form = $("form").get(index);
  //     let id = getFormId(form);
  //     result[id] = getForm(form);
  //   });
  //   return result;
  // }
  function updateFormItem(element) {
    let id = getFormId(element);
    let name = $(element).attr("name");
    let value =
            $(element).val()==="on"
                    ?$(element).prop("checked")
                    :$(element).val()
    ;
    setConfig(id, name, value);
    updateAsset(id);
    $("#tinyurl-button").removeClass("is-hidden");
    $("#tinyurl-result").addClass("is-hidden");

  }
  // function setConfig(id, key, value) {
  //   Config[id][key] = value;
  //   Url.searchParams.set(`${id}_${key}`, value);
  //   replaceUrl(`${Url.search}`);
  // }
  // function updateAsset(id) {
  //   if (!!Animation[id]){
  //     resetLottie(id);
  //   }
  //   if (id==="message"){
  //     $("#message-text").text(Config["message"]["text"]);
  //   }
  //   if (id==="sound"){
  //     soundLoad();
  //   }
  // }
  // function getFormId(item) {
  //   return $(item).closest("form").attr("data-target");
  // }

  // function getForm(form) {
  //   let result = {};
  //   let data = $(form).serializeArray();
  //   data.forEach(function(item) {
  //     let id = getFormId(item);
  //     let value;
  //     switch (item["name"]) {
  //       case "loop":
  //         value = item["value"] === "on";
  //         break;
  //       default:
  //         value = item["value"];
  //     }
  //     result[item["name"]] = value;
  //   });
  //   return result;
  // }
  // function getSound() {
  //   let s = $("#sound");
  //   return s[0];
  // }
  // function soundLoad() {
  //   $("#mp3").attr("src", Config["sound"]["mp3"]);
  //   Sound.pause();
  //   Sound.load();
  // }
  // function getUrl(){
  //   let href = window.location.href;
  //   let u = new URL(href);
  //   if (u.hash!==""){
  //     return new URL(`${u.origin}${u.pathname}${atob(u.hash.slice(1))}${u.hash}`);
  //   }
  //   return u;
  // }
  // function replaceUrl(str) {
  //   window.history.replaceState(
  //           "",
  //           "",
  //           `${Url.pathname}${str}`
  //   );
  // }
  // function setFormsFromUrl(searchParams){
  //   for(let [name, value] of searchParams) {
  //     let a = name.split("_");
  //     let selector = `form[data-target="${a[0]}"]`;
  //     switch (a[1]) {
  //       case 'loop':
  //         $(selector+' [name="loop"]').attr('checked',value!=="false");
  //         break;
  //       default:
  //         $(`${selector} [name="${a[1]}"]`).val(value);
  //     }
  //   }
  // }
</script>

<script>
  // $("#config-panel figure").on("click",function () {
  //   let id = $(this).attr("id");
  //   Animation[id].goToAndPlay(0);
  // });

  // function startShow() {
  //   Sound.play();
  //   updateAsset("message");
  //   attachLotties(".modal");
  //   $('.modal').removeClass("is-hidden");
  //   Animation["background"].goToAndPlay(0);
  //
  //   let d = Config["foreground"]["delay"]|0;
  //   setTimeout(function () {
  //     $(".modal-card").removeClass("is-hidden");
  //     Animation["hero"].goToAndPlay(0);
  //   }, d );
  //   let t = Config["foreground"]["duration"];
  //   setTimeout(function () {
  //     $('.modal').addClass("is-hidden");
  //     $(".modal-card").addClass("is-hidden");
  //     Sound.pause();
  //     Sound.currentTime = 0;
  //     attachLotties("#config-panel");
  //   }, t );
  // }
</script>
</body>
</html>